# 机器学习模块删除实施计划

## 概述

本实施计划将系统性地删除前后端机器学习功能以及相关数据库组件，但保留MLflow追踪功能，确保核心检测功能保持完整。

## 任务

- [x] 1. 准备和备份阶段
  - 创建ML相关数据和文件的完整备份
  - 记录当前系统状态和ML功能使用情况
  - _需求: 9.1, 9.2, 9.4_

- [x] 1.1 备份ML相关数据库表
  - 导出ml_models、ml_experiments、ml_runs等表数据
  - 创建数据库结构备份脚本
  - _需求: 9.1_

- [x] 1.2 备份ML相关文件（排除MLflow）
  - 备份backend/ml/risk_predictor.py
  - 备份backend/ml/anomaly_detector.py  
  - 备份backend/services/ml_engine.py
  - 不备份mlflow_tracker.py（保留使用）
  - _需求: 9.2_

- [x] 1.3 记录系统当前状态
  - 记录ML API接口列表
  - 记录ML相关依赖包
  - 创建删除前的系统快照
  - _需求: 9.4_

- [x] 2. 前端ML功能清理
  - 删除ML相关Vue组件和页面
  - 更新路由配置和导航菜单
  - 清理前端API调用
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [x] 2.1 删除MLDashboard.vue文件
  - 删除frontend/src/views/MLDashboard.vue
  - 确认没有其他组件引用此文件
  - _需求: 5.1_

- [x] 2.2 更新前端路由配置
  - 从router/index.js中移除ML相关路由
  - 添加ML路由的重定向处理
  - _需求: 5.2_

- [x] 2.3 清理导航菜单和链接
  - 从主导航中移除ML相关选项
  - 从Dashboard.vue中移除ML功能卡片
  - 更新侧边栏菜单配置
  - _需求: 5.3_

- [x] 2.4 清理前端API调用
  - 从api/index.js中移除所有ML相关方法
  - 检查并移除组件中的ML API调用
  - _需求: 5.4_

- [x] 3. 后端API模块清理
  - 完全删除ML API文件
  - 更新蓝图注册和应用配置
  - _需求: 1.1, 1.2, 1.4, 1.5_

- [x] 3.1 删除ML API文件
  - 删除backend/api/ml.py文件
  - 确认文件已完全移除
  - _需求: 1.4_

- [x] 3.2 更新蓝图注册
  - 从backend/api/__init__.py中移除ML蓝图导入
  - 从backend/app.py中移除ML蓝图注册
  - _需求: 1.5_

- [x] 3.3 验证API清理结果
  - 测试ML API接口返回404错误
  - 确认系统启动时不加载ML路由
  - _需求: 1.1, 1.2_

- [x] 4. 服务层组件清理
  - 删除ML服务文件和整个ML模块目录
  - 清理其他服务中的ML依赖
  - _需求: 2.1, 2.2, 2.3, 2.5_

- [x] 4.1 删除ML引擎服务
  - 删除backend/services/ml_engine.py文件
  - 检查其他服务是否引用ml_engine
  - _需求: 2.1_

- [x] 4.2 删除ML模块文件（保留MLflow）
  - 删除backend/ml/risk_predictor.py
  - 删除backend/ml/anomaly_detector.py
  - 保留backend/ml/mlflow_tracker.py文件
  - 保留backend/ml/__init__.py文件
  - _需求: 2.2_

- [x] 4.3 清理服务间ML依赖
  - 检查alert_service.py中的ML引用
  - 检查portrait_service.py中的ML引用
  - 添加优雅的ML功能缺失处理
  - _需求: 2.5_

- [x] 5. 保留MLflow追踪功能
  - 确认MLflow相关文件和配置保持完整
  - 验证MLflow功能正常工作
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 5.1 验证MLflow文件完整性
  - 确认runs/mlflow/目录保持不变
  - 确认backend/ml/mlflow_tracker.py文件存在
  - _需求: 3.1, 3.2_

- [x] 5.2 验证MLflow配置
  - 确认MLflow相关环境变量保持不变
  - 确认MLflow配置文件完整
  - _需求: 3.4_

- [x] 5.3 保留MLflow依赖
  - 确认requirements.txt中保留mlflow包
  - 确认MLflow相关依赖包完整
  - _需求: 3.5_

- [x] 6. 数据库ML表清理
  - 删除所有ML相关数据库表
  - 更新数据库迁移脚本
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 6.1 识别ML相关数据表
  - 检查数据库中是否存在ml_models表
  - 检查数据库中是否存在ml_experiments表
  - 检查数据库中是否存在ml_runs表
  - 检查数据库中是否存在model_predictions表
  - _需求: 4.1, 4.2, 4.3, 4.4_

- [x] 6.2 执行数据表删除
  - 创建数据表删除脚本
  - 执行DROP TABLE语句删除ML表
  - 验证表删除成功
  - _需求: 4.5_

- [ ] 6.3 更新数据库迁移
  - 创建新的迁移脚本记录ML表删除
  - 更新数据库版本控制
  - _需求: 4.5_

- [x] 7. 调整依赖包配置
  - 移除ML训练相关依赖包
  - 保留MLflow相关配置
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 7.1 更新Python依赖
  - 从requirements.txt移除scikit-learn
  - 从requirements.txt移除pandas（如果仅用于ML）
  - 保留requirements.txt中的mlflow
  - _需求: 6.1, 6.2_

- [ ] 7.2 保留MLflow环境变量
  - 确认MLflow相关环境变量保持不变
  - 更新.env文件模板保留MLflow配置
  - _需求: 6.3_

- [ ] 7.3 保留MLflow Docker配置
  - 确认Dockerfile保留MLflow依赖（如果存在）
  - 确认docker-compose.yml保留MLflow服务（如果存在）
  - _需求: 6.4_

- [ ] 8. 系统文档更新
  - 更新所有相关文档移除ML功能说明
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 8.1 更新README文档
  - 从README.md中移除前后端ML功能介绍
  - 保留MLflow功能说明和使用指南
  - 更新功能列表和架构说明
  - _需求: 7.1_

- [ ] 8.2 更新API文档
  - 移除ML API接口文档
  - 更新API接口列表
  - _需求: 7.2_

- [ ] 8.3 更新架构文档
  - 更新系统架构图移除前后端ML组件
  - 保留MLflow组件在架构图中
  - 更新技术栈说明
  - _需求: 7.3_

- [x] 9. 核心功能验证测试
  - 验证删除ML功能后核心检测功能正常
  - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 9.1 检测功能测试
  - 测试图片上传和检测功能
  - 测试视频上传和检测功能
  - 验证检测结果准确性
  - _需求: 8.1, 8.2_

- [x] 9.2 预警功能测试
  - 测试预警规则触发
  - 测试预警通知功能
  - 验证预警历史记录
  - _需求: 8.4_

- [x] 9.3 学生画像功能测试
  - 测试学生行为统计
  - 测试画像数据展示
  - 验证数据分析功能
  - _需求: 8.5_

- [x] 9.4 系统集成测试
  - 测试用户登录和权限
  - 测试数据库连接和查询
  - 验证系统整体稳定性
  - _需求: 8.3_

- [x] 10. 系统性能和稳定性验证
  - 验证系统启动和运行稳定性
  - 监控性能改善情况
  - _需求: 10.1, 10.2, 10.3, 10.4, 10.5_

- [x] 10.1 系统启动测试
  - 验证后端服务正常启动
  - 验证前端应用正常加载
  - 检查启动日志无前后端ML相关错误
  - 验证MLflow功能仍可正常访问
  - _需求: 10.2_

- [x] 10.2 性能基准测试
  - 测量删除前后的系统性能
  - 记录内存使用改善情况
  - 记录响应时间变化
  - _需求: 10.4_

- [x] 10.3 错误处理测试
  - 测试ML API访问返回404
  - 测试系统对ML功能缺失的处理
  - 验证错误日志记录正确
  - _需求: 10.1, 10.5_

- [ ] 11. 最终验证和清理
  - 执行完整的系统验证
  - 清理临时文件和备份
  - 创建删除完成报告

- [ ] 11.1 完整系统回归测试
  - 执行所有核心功能的端到端测试
  - 验证用户工作流程完整性
  - 确认没有功能缺失或错误

- [ ] 11.2 创建删除完成报告
  - 记录所有删除的组件和文件
  - 记录保留的MLflow功能
  - 记录系统性能改善数据
  - 提供回滚方案文档

- [ ] 11.3 清理临时文件
  - 清理备份文件（保留重要备份）
  - 清理测试过程中的临时文件
  - 整理项目目录结构

## 注意事项

- 所有MLflow相关功能和文件将被保留
- 只删除前后端的ML训练、预测和分析功能
- 建议按顺序执行任务以避免依赖问题
- 在执行删除操作前务必完成备份工作
- 每个阶段完成后都应进行测试验证
- MLflow追踪功能应在删除完成后仍可正常使用