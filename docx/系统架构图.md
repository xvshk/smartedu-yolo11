# 系统架构图

## 项目名称
基于YOLO11课堂行为感知与多维时空数据的大学生学业全景画像与精准预警系统

---

## 一、系统总体架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                   用户层                                         │
├─────────────────┬─────────────────┬─────────────────┬───────────────────────────┤
│    管理员       │      教师       │      学生       │      桌面检测应用          │
│  (Admin)        │   (Teacher)     │   (Student)     │   (Desktop App)           │
└────────┬────────┴────────┬────────┴────────┬────────┴─────────────┬─────────────┘
         │                 │                 │                      │
         ▼                 ▼                 ▼                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              前端展示层 (Vue 3)                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ │
│  │ 仪表盘   │ │ 实时检测 │ │ 智能预警 │ │ 学业画像 │ │ 通知管理 │ │ 用户管理 │ │
│  │Dashboard │ │Detection │ │  Alert   │ │ Portrait │ │Notification│ │  Users   │ │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘ │
├─────────────────────────────────────────────────────────────────────────────────┤
│  Element Plus + ECharts + Pinia + Vue Router + Axios                            │
└────────────────────────────────────┬────────────────────────────────────────────┘
                                     │ HTTP/REST API
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              后端服务层 (Flask)                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           API 接口层                                     │   │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐     │   │
│  │  │ auth   │ │dashboard│ │detection│ │ alert  │ │portrait│ │  user  │     │   │
│  │  └────────┘ └────────┘ └────────┘ └────────┘ └────────┘ └────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                          业务服务层                                      │   │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐            │   │
│  │  │ detection  │ │   alert    │ │  portrait  │ │notification│            │   │
│  │  │  service   │ │  service   │ │  service   │ │  service   │            │   │
│  │  └────────────┘ └────────────┘ └────────────┘ └────────────┘            │   │
│  │  ┌────────────┐ ┌────────────┐                                          │   │
│  │  │rule_engine │ │intervention│                                          │   │
│  │  │  (规则引擎) │ │  service   │                                          │   │
│  │  └────────────┘ └────────────┘                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────────────────────┤
│  Flask-JWT-Extended (认证) + Flask-CORS (跨域)                                  │
└────────────────────────────────────┬────────────────────────────────────────────┘
                                     │
         ┌───────────────────────────┼───────────────────────────┐
         ▼                           ▼                           ▼
┌─────────────────┐     ┌─────────────────────┐     ┌─────────────────────┐
│   数据存储层    │     │    AI算法层         │     │    模型评估层       │
│   (MySQL 8.0)   │     │   (YOLO11)          │     │   (MLflow)          │
├─────────────────┤     ├─────────────────────┤     ├─────────────────────┤
│ • users         │     │ • Ultralytics       │     │ • mlflow_tracker    │
│ • classes       │     │ • PyTorch + CUDA    │     │ • 模型版本管理      │
│ • students      │     │ • RTX 4050 GPU      │     │ • 性能指标追踪      │
│ • detections    │     │ • 7种行为检测       │     └─────────────────────┘
│ • alerts        │     │   - handrise        │
│ • notifications │     │   - read/write      │
│ • alert_rules   │     │   - sleep/stand     │
│ • feedbacks     │     │   - talk            │
└─────────────────┘     │   - using_devices   │
                        └─────────────────────┘
```

---

## 二、技术架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                技术架构                                          │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              前端技术栈                                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│   │   Vue 3     │    │Element Plus │    │   ECharts   │    │   Pinia     │     │
│   │  (框架)     │    │  (UI组件)   │    │  (图表)     │    │  (状态管理) │     │
│   └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘     │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│   │ Vue Router  │    │   Axios     │    │    Vite     │    │    SCSS     │     │
│   │  (路由)     │    │  (HTTP)     │    │  (构建)     │    │  (样式)     │     │
│   └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              后端技术栈                                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│   │   Flask     │    │Flask-JWT    │    │ Flask-CORS  │    │  PyMySQL    │     │
│   │  (框架)     │    │ (JWT认证)   │    │  (跨域)     │    │  (数据库)   │     │
│   └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              AI/ML技术栈                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│   │  YOLO11     │    │  PyTorch    │    │   CUDA      │    │   MLflow    │     │
│   │ (目标检测)  │    │ (深度学习)  │    │  (GPU加速)  │    │ (模型管理)  │     │
│   └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘     │
│   ┌─────────────┐    ┌─────────────┐                                           │
│   │Ultralytics  │    │  OpenCV     │                                           │
│   │ (YOLO框架)  │    │ (视频处理)  │                                           │
│   └─────────────┘    └─────────────┘                                           │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              数据存储                                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│   ┌─────────────────────────────────────────────────────────────────────┐      │
│   │                        MySQL 8.0                                     │      │
│   │   • 用户数据 (users, students, classes)                             │      │
│   │   • 检测数据 (detection_sessions, detection_records)                │      │
│   │   • 预警数据 (alerts, alert_rules)                                  │      │
│   │   • 通知数据 (notifications, feedbacks)                             │      │
│   └─────────────────────────────────────────────────────────────────────┘      │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 三、功能模块架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    基于YOLO11课堂行为感知与精准预警系统                           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │
        ┌─────────────────────────────┼─────────────────────────────┐
        │                             │                             │
        ▼                             ▼                             ▼
┌───────────────────┐     ┌───────────────────┐     ┌───────────────────┐
│   行为感知模块    │     │   数据分析模块    │     │   预警干预模块    │
├───────────────────┤     ├───────────────────┤     ├───────────────────┤
│ • YOLO11检测      │     │ • 学业画像生成    │     │ • 规则引擎        │
│ • 实时视频流      │     │ • 行为分布统计    │     │ • 智能预警        │
│ • GPU加速推理     │     │ • 趋势分析        │     │ • 通知推送        │
│ • 7种行为识别     │     │ • 班级概览        │     │ • 学生反馈        │
└───────────────────┘     └───────────────────┘     └───────────────────┘
        │                             │                             │
        └─────────────────────────────┼─────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              系统管理模块                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│   │ 用户认证    │    │ 权限管理    │    │ 仪表盘      │    │ 用户管理    │     │
│   │ JWT Token   │    │ RBAC控制    │    │ 数据展示    │    │ CRUD操作    │     │
│   └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 四、数据流架构图

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│  摄像头  │────▶│ 视频流   │────▶│ YOLO11   │────▶│ 检测结果 │────▶│ 数据库   │
│  输入    │     │ 采集     │     │ 推理     │     │ 解析     │     │ 存储     │
└──────────┘     └──────────┘     └──────────┘     └──────────┘     └──────────┘
                                                                          │
                                                                          ▼
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│  前端    │◀────│ API响应  │◀────│ 业务处理 │◀────│ 规则引擎 │◀────│ 数据查询 │
│  展示    │     │          │     │          │     │ 预警判断 │     │          │
└──────────┘     └──────────┘     └──────────┘     └──────────┘     └──────────┘
     │
     ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                              用户交互                                         │
├──────────────────────────────────────────────────────────────────────────────┤
│  • 查看仪表盘统计数据                                                         │
│  • 查看实时检测结果                                                           │
│  • 查看学业画像分析                                                           │
│  • 处理预警通知                                                               │
│  • 发送/接收通知反馈                                                          │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 五、部署架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              客户端                                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│   ┌─────────────────────┐              ┌─────────────────────┐                 │
│   │     Web浏览器       │              │    桌面检测应用     │                 │
│   │  http://localhost:3000             │  detection_app.py   │                 │
│   │  (Vue 3 SPA)        │              │  (PyQt + YOLO11)    │                 │
│   └──────────┬──────────┘              └──────────┬──────────┘                 │
│              │                                    │                            │
└──────────────┼────────────────────────────────────┼────────────────────────────┘
               │ HTTP                               │ HTTP
               ▼                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              服务端                                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│   ┌─────────────────────────────────────────────────────────────────────┐      │
│   │                    Flask Backend Server                              │      │
│   │                    http://127.0.0.1:5000                            │      │
│   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │      │
│   │   │  API路由    │  │  业务服务   │  │  数据访问   │                │      │
│   │   │  /api/*     │  │  Services   │  │ Repositories│                │      │
│   │   └─────────────┘  └─────────────┘  └─────────────┘                │      │
│   └─────────────────────────────────────────────────────────────────────┘      │
│                                    │                                           │
│                                    ▼                                           │
│   ┌─────────────────────────────────────────────────────────────────────┐      │
│   │                        MySQL 8.0 Database                            │      │
│   │                        localhost:3306                                │      │
│   │                        Database: smartedu                            │      │
│   └─────────────────────────────────────────────────────────────────────┘      │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              GPU计算                                             │
├─────────────────────────────────────────────────────────────────────────────────┤
│   ┌─────────────────────────────────────────────────────────────────────┐      │
│   │              NVIDIA GeForce RTX 4050 Laptop GPU                      │      │
│   │   • CUDA 加速                                                        │      │
│   │   • YOLO11 模型推理                                                  │      │
│   │   • 实时视频流处理                                                   │      │
│   └─────────────────────────────────────────────────────────────────────┘      │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 六、目录结构

```
SmartEdu/
├── src/                        # 源代码模块
│   ├── core/                   # 核心业务逻辑
│   │   ├── config/             # 行为配置
│   │   │   └── behavior_config.py
│   │   ├── data/               # 数据预处理
│   │   │   ├── data_merger.py
│   │   │   └── label_mapper.py
│   │   ├── training/           # 模型训练
│   │   │   └── training_pipeline.py
│   │   └── database/           # 数据库访问层
│   │       ├── config.py
│   │       ├── manager.py
│   │       ├── repositories/   # 数据仓库 (8个)
│   │       └── services/
│   ├── scripts/                # CLI脚本入口
│   │   ├── yolo_validate.py    # 模型验证
│   │   ├── train.py            # 模型训练
│   │   └── train_optimized_4050.py
│   └── utils/                  # 工具模块
│       ├── data_validation_utils.py  # 业务层服务
│       └── data_validation/          # 三层架构
│           ├── constants.py
│           ├── validators.py
│           ├── analyzers.py
│           ├── visualizers.py
│           ├── reporters.py
│           └── cleaners.py
├── backend/                    # 后端代码
│   ├── api/                    # API接口
│   │   ├── auth.py
│   │   ├── dashboard.py
│   │   ├── detection.py
│   │   ├── alert.py
│   │   ├── portrait.py
│   │   ├── notification.py
│   │   └── user.py
│   ├── services/               # 业务服务
│   │   ├── detection_service.py
│   │   ├── alert_service.py
│   │   ├── portrait_service.py
│   │   ├── notification_service.py
│   │   ├── rule_engine.py
│   │   └── intervention_service.py
│   ├── ml/                     # 机器学习
│   │   └── mlflow_tracker.py
│   ├── app.py
│   └── config.py
├── frontend/                   # 前端代码
│   ├── src/
│   │   ├── views/              # 页面组件
│   │   ├── components/         # 通用组件
│   │   ├── stores/             # Pinia状态
│   │   ├── api/                # API调用
│   │   └── styles/             # 样式文件
│   └── package.json
├── desktop/                    # 桌面应用
│   └── detection_app.py
├── tests/                      # 测试用例
├── runs/                       # 运行结果
│   ├── detect/
│   ├── mlflow/
│   └── models/
├── archive/                    # 归档文件
├── docx/                       # 项目文档
└── yolo11s.pt                  # YOLO11预训练模型
```

---

## 七、角色权限架构

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              角色权限模型 (RBAC)                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│     管理员      │     │      教师       │     │      学生       │
│    (admin)      │     │   (teacher)     │     │   (student)     │
├─────────────────┤     ├─────────────────┤     ├─────────────────┤
│ ✓ 用户管理     │     │ ✓ 实时检测     │     │ ✓ 个人仪表盘   │
│ ✓ 系统配置     │     │ ✓ 班级画像     │     │ ✓ 个人画像     │
│ ✓ 全局统计     │     │ ✓ 学生画像     │     │ ✓ 接收通知     │
│ ✓ 所有教师权限 │     │ ✓ 预警管理     │     │ ✓ 提交反馈     │
│                │     │ ✓ 发送通知     │     │                 │
│                │     │ ✓ 查看反馈     │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```
